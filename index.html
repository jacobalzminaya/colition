<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
 <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <title>Quantum Alpha PRO v22 | Ultimate Edition</title>
<style>
    :root {
        --bg-color: #040508;
        --panel-bg: rgba(10, 13, 17, 0.9);
        --up-neon: #00ff88; 
        --down-neon: #ff2e63; 
        --accent: #4a90e2;
        --text-dim: #717b87;
        --text-main: #ffffff;
        --border: #1c2128;
        --glow: rgba(74, 144, 226, 0.2);
    }

    /* --- RESET Y BASE --- */
    body {  
        background: var(--bg-color);
        color: var(--text-main);
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        margin: 0;
        overflow: hidden;
        -webkit-tap-highlight-color: transparent;
    }

    .terminal, .btn, #mouse-overlay, #manual-touch-zone, .touch-trigger {
        user-select: none;
        -webkit-user-select: none;
    }

    /* --- CAPA RADAR (BLINDADA) --- */
    #mouse-overlay {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 1; 
        cursor: crosshair;
        background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.7) 100%);
        touch-action: none;
    }
    #mouse-overlay.active-radar { display: block; }

    /* --- CONTENEDOR PRINCIPAL (TERMINAL) --- */
    .terminal {
        background: var(--panel-bg);
        width: 95%;
        max-width: 460px;
        border-radius: 24px;
        padding: 24px;
        border: 2px solid var(--border);
        position: relative;
        z-index: 10;
        box-shadow: 0 40px 80px rgba(0,0,0,0.8);
        backdrop-filter: blur(15px);
        /* Transici√≥n suave para cambios de color inducidos por RUIDO o CALIDAD */
        transition: background 0.5s ease, border-color 0.4s ease, box-shadow 0.4s ease, transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    /* --- INFORMACI√ìN DE CABECERA --- */
    .header-info {
        display: flex;
        justify-content: space-between;
        font-size: 10px;
        font-weight: 900;
        margin-bottom: 15px;
        color: var(--text-dim);
        letter-spacing: 1px;
        text-transform: uppercase;
    }

    /* --- GR√ÅFICO --- */
    #flow-chart {
        width: 100%;
        height: 80px;
        background: rgba(0,0,0,0.4);
        border-radius: 12px;
        margin-bottom: 15px;
        border: 1px solid var(--border);
        display: block;
    }

    /* --- SELECTORES Y BOTONES --- */
    .selectors-grid {
        display: grid;
        grid-template-columns: 1.5fr 1.1fr;
        gap: 12px;
        margin-bottom: 15px;
    }

    .btn-group { display: flex; gap: 4px; flex-wrap: wrap; }
    
    .btn {
        background: #161b22;
        border: 1px solid var(--border);
        color: var(--text-dim);
        padding: 8px 2px;
        border-radius: 8px;
        font-size: 10px;
        font-weight: 800;
        cursor: pointer;
        flex: 1;
        transition: 0.2s;
        position: relative;
        z-index: 11; /* Prioridad sobre el radar */
    }
    
    .btn.active { 
        background: var(--accent); 
        color: white; 
        border-color: var(--accent); 
        box-shadow: 0 0 15px var(--glow); 
    }

    .btn:active, .feed-btn:active, .touch-trigger:active {
        transform: scale(0.96);
        filter: brightness(1.2);
    }

    /* --- TRACK DE ENTRADAS --- */
    .input-track {
        background: rgba(0,0,0,0.6);
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        font-size: 20px;
        border: 1px solid var(--border);
    }

    /* --- ZONA DE SE√ëALES --- */
    .signal-zone {
        height: 180px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
        border-radius: 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(255,255,255,0.05);
        position: relative;
        overflow: hidden;
    }

    #big-icon { font-size: 80px; font-weight: bold; display: none; z-index: 2; }
    #op-status { font-size: 1.8rem; font-weight: 900; margin-top: 5px; z-index: 2; }
    #op-details { font-size: 11px; color: var(--accent); font-weight: 700; text-transform: uppercase; z-index: 2; }

    #mouseBtn {
        width: 100%;
        padding: 16px;
        border-radius: 14px;
        border: 2px solid var(--accent);
        background: transparent;
        color: var(--accent);
        font-weight: 900;
        cursor: pointer;
        margin-bottom: 15px;
        text-transform: uppercase;
        letter-spacing: 2px;
        transition: 0.3s ease;
        z-index: 11;
    }
    #mouseBtn.radar-on { 
        background: var(--accent); 
        color: white; 
        box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4); 
    }
    #mouseBtn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        background: #111;
        color: var(--text-dim);
        border-color: var(--text-dim);
    }

    /* --- REPORTES IA --- */
    #ia-report {
        background: rgba(0,0,0,0.5);
        border-radius: 12px;
        padding: 14px;
        font-size: 11px;
        margin-bottom: 15px;
        border-left: 4px solid var(--accent);
    }

    .feedback-grid { 
        display: none; 
        grid-template-columns: 1fr 1fr; 
        gap: 10px; 
        margin-bottom: 10px;
        opacity: 0;
        transition: opacity 0.4s ease;
    }
    .signal-active .feedback-grid { display: grid; opacity: 1; }

    .feed-btn {
        padding: 16px;
        border-radius: 12px;
        color: #000 !important;
        font-weight: 900;
        cursor: pointer;
        border: none;
        z-index: 11;
    }

    /* --- TOUCH ZONE MANUAL --- */
    #manual-touch-zone {
        display: none;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        height: 70px;
        margin-top: 5px;
    }
    .touch-trigger {
        background: #111;
        border: 1px solid var(--border);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 32px;
        cursor: pointer;
        box-shadow: 0 4px 0 #000;
        transition: all 0.08s;
        z-index: 11;
    }

    /* --- CLASES DE ESTADO (DIN√ÅMICAS) --- */
    .text-up { color: var(--up-neon) !important; text-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
    .text-down { color: var(--down-neon) !important; text-shadow: 0 0 20px rgba(255, 46, 99, 0.6); }
    
    /* Bordes Ne√≥n para Se√±al Activa */
    .border-up { border-color: var(--up-neon) !important; box-shadow: 0 0 40px rgba(0, 255, 136, 0.2); }
    .border-down { border-color: var(--down-neon) !important; box-shadow: 0 0 40px rgba(255, 46, 99, 0.2); }

    /* Barra de Tiempo */
    #timer-bar {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 0%;
        height: 4px;
        background: var(--accent);
        transition: width linear;
        will-change: width;
    }

   /* --- RESPONSIVIDAD --- */
@media (max-width: 400px) {
    .terminal { padding: 15px; }
    #big-icon { font-size: 60px; }
    .selectors-grid { gap: 8px; }
    .btn { font-size: 9px; }
}

/* --- ANIMACIONES DE LATIDO (Sincronizadas y Suaves) --- */

/* Brillo del icono central durante se√±al */
@keyframes pulse-glow {
    0%, 100% { filter: brightness(1.0); transform: scale(1.0); }
    50%      { filter: brightness(1.15); transform: scale(1.05); } 
}

/* Latido para RUIDO ALTO (Rojo) */
@keyframes heartbeat-red {
    0%   { transform: scale(1.00); box-shadow: 0 0 15px rgba(255, 46, 99, 0.15); }
    50%  { transform: scale(1.03); box-shadow: 0 0 25px rgba(255, 46, 99, 0.35); }
    100% { transform: scale(1.00); box-shadow: 0 0 15px rgba(255, 46, 99, 0.15); }
}

/* Latido para RUIDO ALTO (Verde) */
@keyframes heartbeat-green {
    0%   { transform: scale(1.00); box-shadow: 0 0 15px rgba(0, 255, 136, 0.15); }
    50%  { transform: scale(1.03); box-shadow: 0 0 25px rgba(0, 255, 136, 0.35); }
    100% { transform: scale(1.00); box-shadow: 0 0 15px rgba(0, 255, 136, 0.15); }
}

/* --- CLASES DE ACTIVACI√ìN --- */

.signal-active #big-icon {
    animation: pulse-glow 2.5s infinite ease-in-out;
}

.high-noise-heart-red {
    animation: heartbeat-red 2.5s infinite ease-in-out !important;
    border-color: rgba(255, 46, 99, 0.5) !important;
}

.high-noise-heart-green {
    animation: heartbeat-green 2.5s infinite ease-in-out !important;
    border-color: rgba(0, 255, 136, 0.5) !important;
}
/* Estilo base mejorado para los gatillos manuales */
.touch-trigger {
    background: #0a0d11;
    border: 1px solid var(--border);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    cursor: pointer;
    transition: all 0.1s ease;
    z-index: 11;
}

/* Color para el bot√≥n Alcista (A) */
.touch-trigger.t-up {
    color: var(--up-neon);
    border-color: rgba(0, 255, 136, 0.3);
    box-shadow: inset 0 0 10px rgba(0, 255, 136, 0.05);
}

/* Color para el bot√≥n Bajista (B) */
.touch-trigger.t-down {
    color: var(--down-neon);
    border-color: rgba(255, 46, 99, 0.3);
    box-shadow: inset 0 0 10px rgba(255, 46, 99, 0.05);
}

/* Efecto visual al tocar/hacer clic */
.touch-trigger.t-up:active {
    background: rgba(0, 255, 136, 0.1);
    transform: scale(0.95);
}

.touch-trigger.t-down:active {
    background: rgba(255, 46, 99, 0.1);
    transform: scale(0.95);
}
</style>
</head>
<body>

<div id="mouse-overlay"></div>

<div class="terminal" id="main-terminal">
    <div class="header-info">
        <span id="speed-meter">MS: 0</span>
        <span id="power-index">POWER: 0.0</span>
        <span id="noise-index">NOISE: 0%</span>
    </div>

    <canvas id="flow-chart"></canvas>

    <div class="selectors-grid">
        <div class="btn-group" id="time-group">
            <button class="btn" id="t5" onclick="setTime(5, this)">5S</button>
            <button class="btn" id="t15" onclick="setTime(15, this)">15S</button>
            <button class="btn" id="t30" onclick="setTime(30, this)">30S</button>
            <button class="btn" id="t60" onclick="setTime(60, this)">1M</button>
        </div>
<div class="btn-group" id="risk-group">
    <button class="btn" id="r1" onclick="setRisk(1, this)">N1</button>
    <button class="btn" id="r2" onclick="setRisk(2, this)">N2</button>
    <button class="btn" id="r3" onclick="setRisk(3, this)">N3</button>
    <button id="neuralBtn" class="btn" style="border-color:#00ff88; color:#00ff88" onclick="toggleNeuralMode()">NEURAL</button>
    <button id="flexBtn" class="btn" style="border-color:#8957e5" onclick="toggleFlexMode()">FLEX</button>
</div>
    </div>

<!-- Campo 1: SOLO S√çMBOLOS (arriba) -->
<div class="input-track" id="symbols-track">
    <span style="color: var(--text-dim); font-size: 11px;">ACTIVA EL RADAR PARA INICIAR</span>
</div>

<!-- Campo 2: SOLO MENSAJES + bot√≥n undo (abajo) -->
<div style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px;">
    <div class="input-track" id="status-track" style="flex: 1; margin-bottom: 0;">
        <span id="status-message" style="color: var(--text-dim); font-size: 11px;">ESPERANDO SECUENCIA...</span>
    </div>
    
    <button onclick="undoLastInput(event)" title="Borrar √∫ltimo" style="background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); color: #ff2e63; width: 45px; height: 45px; border-radius: 12px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: 0.2s;">
        ‚Ü∂
    </button>
</div>

    <button id="mouseBtn" onclick="toggleMouse()">INICIAR SENSOR RADAR</button>

    <div class="signal-zone">
        <div id="big-icon"></div>
        <div id="op-status">SYSTEM IDLE</div>
        <div id="op-details">SCANNING DATA FLOW</div>
        <div id="timer-bar"></div>
    </div>

    <div id="ia-report">
        <div id="ia-logic" style="color: var(--text-dim); margin-bottom: 4px;">IA: WAITING SEQUENCE...</div>
        <div id="ia-stake" style="font-weight: 800; color: #fff;">STAKE SUGGESTION: --</div>
    </div>

    <div class="feedback-grid" id="f-grid">
        <button id="winBtn" class="feed-btn" style="background:var(--up-neon);" onclick="logResult(true)">WIN</button>
        <button id="lossBtn" class="feed-btn" style="background:var(--down-neon)" onclick="logResult(false)">LOSS</button>
    </div>

    <div id="manual-touch-zone">
        <div class="touch-trigger t-up" onclick="registerInput('A')">‚ñ≤</div>
        <div class="touch-trigger t-down" onclick="registerInput('B')">‚ñº</div>
    </div>

    <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 10px; color: var(--text-dim); font-weight: 900;">
        <span>SESI√ìN: <span id="stat-total" style="color:white">0</span></span>
        <span>ACCURACY: <span id="stat-winrate" style="color:white">0%</span></span>
    </div>
</div>

<script>
    let neuralMode = false;

const NeuralCore = {
    model: null,
    async init() {
        this.model = tf.sequential();
        this.model.add(tf.layers.dense({ units: 12, inputShape: [4], activation: 'relu' }));
        this.model.add(tf.layers.dense({ units: 8, activation: 'relu' }));
        this.model.add(tf.layers.dense({ units: 1, activation: 'sigmoid' }));
        this.model.compile({ optimizer: tf.train.adam(0.01), loss: 'binaryCrossentropy' });
        console.log("üß† IA Inicializada");
    },
    async getPrediction(data) {
        if (!this.model) return 0.5;
        const tfData = tf.tensor2d([data]);
        const pred = this.model.predict(tfData);
        const val = (await pred.data())[0];
        tfData.dispose(); pred.dispose();
        return val;
    },
    async train(data, win) {
        const xs = tf.tensor2d([data]);
        const ys = tf.tensor2d([[win ? 1 : 0]]);
        await this.model.fit(xs, ys, { epochs: 5 });
        xs.dispose(); ys.dispose();
    }
};

NeuralCore.init();

function toggleNeuralMode() {
    if(isSignalActive) return;
    neuralMode = !neuralMode;
    const btn = document.getElementById('neuralBtn');
    btn.classList.toggle('active', neuralMode);
    
    // Feedback visual
    const iaLogic = document.getElementById('ia-logic');
    iaLogic.innerText = neuralMode ? "MODO NEURONAL ACTIVADO" : "MODO L√ìGICA EST√ÅNDAR";
}
// --- ESTADO ---
let mouseEnabled = false, flexMode = false, sequence = [], tradeHistory = [];
let lastClickTime = 0, riskLevel = 2, selectedTime = 15;
let isSignalActive = false, signalCooldown = false, countdownInterval = null;
let perfectFlow = false; 

// --- [NUEVO] N√öCLEO DE IA ADAPTATIVA ---
const AICore = {
    weights: JSON.parse(localStorage.getItem('quantum_ai_weights')) || { noiseStrictness: 0 },
    patterns: JSON.parse(localStorage.getItem('quantum_ai_patterns')) || {},
    
    calibrate(isWin) {
        // 1. Pesos Din√°micos: La IA se vuelve estricta si pierde y se relaja si gana
        if (isWin) {
            this.weights.noiseStrictness = Math.max(-10, this.weights.noiseStrictness - 2);
        } else {
            this.weights.noiseStrictness += 5; 
        }
        localStorage.setItem('quantum_ai_weights', JSON.stringify(this.weights));
    },
    
    learn() {
        // 2. Memoria de Micro-Tendencias: Guarda el "ADN" de la secuencia ganadora
        if (sequence.length < 4) return;
        const dna = sequence.slice(-4).map(s => s.val).join('');
        this.patterns[dna] = (this.patterns[dna] || 0) + 1;
        localStorage.setItem('quantum_ai_patterns', JSON.stringify(this.patterns));
    },
    
    getConfidence(dna) {
        // 3. KNN Simplificado: Retorna nivel de coincidencia hist√≥rica
        return this.patterns[dna] || 0;
    }
};

const config = {
    racha: { 1: 3, 2: 4, 3: 5 },
    ruido: { 1: 65, 2: 55, 3: 45 }
};

const AudioEngine = {
    ctx: null,
    init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
    async play(type) {
        this.init();
        if (this.ctx.state === 'suspended') await this.ctx.resume();
        const osc = this.ctx.createOscillator();
        const gain = this.ctx.createGain();
        osc.connect(gain); gain.connect(this.ctx.destination);
        if(type === "CLICK") {
            osc.frequency.setValueAtTime(1200, this.ctx.currentTime);
            gain.gain.setValueAtTime(0.04, this.ctx.currentTime);
            osc.start(); osc.stop(this.ctx.currentTime + 0.03);
        } else {
            osc.frequency.setValueAtTime(type === "COMPRA" ? 880 : 330, this.ctx.currentTime);
            gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.6);
            osc.start(); osc.stop(this.ctx.currentTime + 0.6);
        }
        if(navigator.vibrate) navigator.vibrate(type === "COMPRA" ? [30, 10, 30] : (type === "VENTA" ? [70] : [10]));
    }
};

// --- CANVAS ---
const canvas = document.getElementById('flow-chart');
const ctx = canvas.getContext('2d');
const dpr = window.devicePixelRatio || 1;
canvas.width = canvas.offsetWidth * dpr;
canvas.height = canvas.offsetHeight * dpr;
ctx.scale(dpr, dpr);
let chartData = Array(40).fill(40);

function drawChart() {
    ctx.clearRect(0, 0, canvas.width / dpr, canvas.height / dpr);
    if (!mouseEnabled && sequence.length === 0) return;
    
    ctx.strokeStyle = 'rgba(74, 144, 226, 0.05)';
    ctx.lineWidth = 1;
    for(let i=0; i<canvas.offsetWidth; i+=25) {
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, canvas.offsetHeight); ctx.stroke();
    }

    ctx.beginPath();
    if (perfectFlow) {
        ctx.lineWidth = 6; 
        ctx.shadowBlur = 15;
        const lastVal = sequence[sequence.length-1]?.val;
        ctx.strokeStyle = lastVal === 'A' ? '#00ff88' : '#ff2e63';
        ctx.shadowColor = lastVal === 'A' ? 'rgba(0, 255, 136, 0.8)' : 'rgba(255, 46, 99, 0.8)';
    } else {
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#4a90e2';
        ctx.shadowBlur = 0;
    }

    const step = canvas.offsetWidth / (chartData.length - 1);
    chartData.forEach((val, i) => {
        const x = i * step;
        const y = (canvas.offsetHeight / 2) + (val - 40) * 1.5;
        if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    });
    ctx.stroke();
    ctx.shadowBlur = 0;
}

// --- LOGICA DE ENTRADA Y MODIFICACI√ìN ---

function undoLastInput(e) {
    if (sequence.length === 0 || isSignalActive) return;

    const undoLog = {
        tabla: "nombre_personalizados",
        accion: "UNDO_INPUT",
        ultimo_valor: sequence[sequence.length - 1].val,
        puntos_restantes: sequence.length - 1,
        timestamp: new Date().toISOString()
    };
    console.log("Registrando correcci√≥n en Iniweb...", undoLog);

    sequence.pop();
    
    chartData = Array(40).fill(40);
    sequence.forEach(s => {
        const lastVal = chartData[chartData.length - 1];
        chartData.push(s.val === 'A' ? lastVal - 8 : lastVal + 8);
        if(chartData.length > 40) chartData.shift();
    });

    if (sequence.length === 0) lastClickTime = 0;

    AudioEngine.play("CLICK"); 
    drawChart();
    updateSymbols();
    updateStatusMessage();
    analyze();

    const btn = e ? e.currentTarget : (typeof event !== 'undefined' ? event.currentTarget : null);
    if (btn) {
        btn.style.background = "rgba(255, 46, 99, 0.3)";
        btn.style.borderColor = "#ff2e63";
        btn.style.transform = "scale(0.9)";
        setTimeout(() => {
            btn.style.background = "rgba(255, 255, 255, 0.03)";
            btn.style.borderColor = "var(--border)";
            btn.style.transform = "scale(1)";
        }, 150);
    }
}

function registerInput(val) {
    if (!mouseEnabled || isSignalActive || signalCooldown) return;

    const now = Date.now();
    const diff = (lastClickTime === 0) ? 0 : now - lastClickTime;
    
    if (diff > 0 && diff < 40) return;

    lastClickTime = now;
    AudioEngine.play("CLICK");
    
    sequence.push({val, diff});
    // Margen din√°mico: ajustamos la historia seg√∫n el tiempo seleccionado
    let maxHistory = selectedTime <= 15 ? 15 : 25;
    if(sequence.length > maxHistory) sequence.shift();
    
    const lastVal = chartData[chartData.length - 1] ?? 40;
    chartData.push(val === 'A' ? lastVal - 8 : lastVal + 8);
    if(chartData.length > 40) chartData.shift();
    
    drawChart();
    updateSymbols();
    updateStatusMessage();
    analyze();
}

// --- ANALISIS Y SE√ëALES ---

async function analyze() {
    if (isSignalActive || sequence.length < 3 || signalCooldown) return;
    
    const lastDiff = sequence[sequence.length-1].diff;
    const recent = sequence.slice(-10); 
    const seqStr = recent.map(s => s.val).join('');
    const oscillations = (seqStr.match(/AB|BA/g) || []).length;
    const noiseIndex = Math.min(100, Math.round((oscillations / Math.max(1, seqStr.length - 1)) * 100));
    
    let rawPower = sequence.reduce((acc, s) => {
        let weight = 1000 / Math.max(s.diff, 40);
        return s.val === 'A' ? acc + weight : acc - weight;
    }, 0);
    const power = Math.max(-100, Math.min(100, rawPower));

    const terminal = document.getElementById('main-terminal');
    const iaLogic = document.getElementById('ia-logic');
    const lastVal = recent[recent.length - 1]?.val;

    // --- NUEVO: PREDICCI√ìN NEURONAL (MODO AVANZADO) ---
    let neuralPrediction = 0.5;
    if (typeof NeuralCore !== 'undefined' && NeuralCore.model) {
        neuralPrediction = await NeuralCore.getPrediction([
            lastDiff, 
            lastVal === 'A' ? 1 : -1, 
            noiseIndex, 
            power
        ]);
    }

    // --- IA: DETECCI√ìN DE PATRONES DE ADN (KNN) ---
    const currentDNA = sequence.slice(-4).map(s => s.val).join('');
    const patternConfidence = AICore.getConfidence(currentDNA);

    if (sequence.length >= 3) {
        if (noiseIndex > 30) {
            perfectFlow = false;
            terminal.style.background = "var(--panel-bg)";
            if (lastVal === 'A') {
                terminal.style.borderColor = "#ff2e63";
                terminal.style.boxShadow = "0 0 25px rgba(255, 46, 99, 0.3)";
                iaLogic.innerText = "‚ö†Ô∏è RUIDO ALTO: POSIBLE REVERSI√ìN";
                iaLogic.style.color = "#ff2e63";
                terminal.classList.remove('high-noise-heart-green');
                terminal.classList.add('high-noise-heart-red'); 
            } else {
                terminal.style.borderColor = "#00ff88";
                terminal.style.boxShadow = "0 0 25px rgba(0, 255, 136, 0.3)";
                iaLogic.innerText = "‚ö†Ô∏è RUIDO ALTO: POSIBLE REBOTE";
                iaLogic.style.color = "#00ff88";
                terminal.classList.remove('high-noise-heart-red');
                terminal.classList.add('high-noise-heart-green');
            }
        } 
        else if (noiseIndex <= 15) {
            perfectFlow = true; 
            terminal.classList.remove('high-noise-heart-red', 'high-noise-heart-green');
            if (lastVal === 'A') {
                terminal.style.background = "linear-gradient(145deg, rgba(0, 255, 136, 0.08), var(--panel-bg))";
                terminal.style.borderColor = "#00ff88";
                iaLogic.innerText = "‚≠ê CALIDAD 100%: TENDENCIA ALCISTA";
                iaLogic.style.color = "#00ff88";
            } else {
                terminal.style.background = "linear-gradient(145deg, rgba(255, 46, 99, 0.08), var(--panel-bg))";
                terminal.style.borderColor = "#ff2e63";
                iaLogic.innerText = "‚≠ê CALIDAD 100%: TENDENCIA BAJISTA";
                iaLogic.style.color = "#ff2e63";
            }
        }
        else {
            perfectFlow = false;
            terminal.classList.remove('high-noise-heart-red', 'high-noise-heart-green');
            terminal.style.background = "var(--panel-bg)";
            terminal.style.borderColor = "var(--border)";
            iaLogic.innerText = "IA: ESCANEANDO FLUJO SEGURO...";
            iaLogic.style.color = "var(--text-dim)";
        }

        if (patternConfidence > 1) {
            iaLogic.innerText = `üíé GOLDEN PATTERN DETECTADO (CONF: ${patternConfidence})`;
            iaLogic.style.color = "var(--accent)";
        }

        // --- GESTI√ìN DE MENSAJES DE EXPERIENCIA NEURONAL ---
        if (typeof neuralMode !== 'undefined' && neuralMode) {
            const totalOps = tradeHistory.length;
            const probPct = Math.round(neuralPrediction * 100);
            
            if (totalOps < 20) {
                const faltan = 20 - totalOps;
                iaLogic.innerHTML = `<span style="color:#ffb86c">IA APRENDIENDO: HAZ ${faltan} OPS M√ÅS</span>`;
            } else if (totalOps < 60) {
                const faltan = 60 - totalOps;
                iaLogic.innerHTML = `<span style="color:var(--accent)">CALIBRANDO: ${probPct}% (FALTAN ${faltan})</span>`;
            } else {
                iaLogic.innerHTML = `<span style="color:#8957e5">MODO NEURAL LISTO: ${probPct}% CONF.</span>`;
            }
        }
    }

    document.getElementById('noise-index').innerText = `NOISE: ${noiseIndex}%`;
    document.getElementById('power-index').innerText = `POWER: ${power.toFixed(1)}`;
    document.getElementById('speed-meter').innerText = `MS: ${lastDiff === 0 ? '--' : lastDiff}`;
    
    drawChart();

    // --- L√ìGICA DE DISPARO ---
    if (typeof neuralMode !== 'undefined' && neuralMode) {
        // DISPARO MODO NEURONAL: Solo si tiene 60 o m√°s operaciones de experiencia
        if (tradeHistory.length >= 60 && sequence.length >= 4) {
            if (neuralPrediction > 0.85) triggerSignal("COMPRA", power);
            else if (neuralPrediction < 0.15) triggerSignal("VENTA", power);
        }
    } else {
        // DISPARO MODO EST√ÅNDAR (L√≥gica original)
        let rachaReq = config.racha[riskLevel];
        if (patternConfidence > 3) rachaReq = Math.max(2, rachaReq - 1);

        let streak = 1;
        for (let i = recent.length - 2; i >= 0; i--) {
            if (recent[i].val === lastVal) streak++;
            else break;
        }

        let maxNoise = (config.ruido[riskLevel] + (flexMode ? 15 : 0)) - AICore.weights.noiseStrictness;

        if (streak >= rachaReq && noiseIndex <= maxNoise) {
            triggerSignal(lastVal === 'A' ? "COMPRA" : "VENTA", power);
        }
    }
}

// --- UI UPDATES ---

function updateStatusMessage() {
    const statusMessage = document.getElementById('status-message');
    const noiseNum = parseInt(document.getElementById('noise-index').innerText.replace('NOISE: ', '')) || 0;

    if (noiseNum > 30) {
        statusMessage.innerText = '‚ö†Ô∏è RUIDO ALTO';
        statusMessage.style.color = '#ff2e63';
        statusMessage.style.fontWeight = 'bold';
    } else if (noiseNum <= 15) {
        statusMessage.innerText = '‚≠ê CALIDAD ALTA';
        statusMessage.style.color = '#00ff88';
        statusMessage.style.fontWeight = 'bold';
    } else {
        statusMessage.innerText = 'ESCANEANDO...';
        statusMessage.style.color = 'var(--accent)';
    }
}

function updateSymbols() {
    const symbolsTrack = document.getElementById('symbols-track');
    if (!symbolsTrack) return;
    
    if (sequence.length === 0) {
        symbolsTrack.innerHTML = mouseEnabled 
            ? '<span style="color:var(--text-dim);font-size:12px;">ESPERANDO ENTRADAS...</span>'
            : '<span style="color:var(--text-dim);font-size:11px;">ACTIVA EL RADAR PARA INICIAR</span>';
        return;
    }

    const symbols = sequence.slice(-10).map(s => 
        `<span class="${s.val === 'A' ? 'text-up' : 'text-down'}" style="font-size:20px;">${s.val === 'A' ? '‚ñ≤' : '‚ñº'}</span>`
    ).join('  ‚Ä¢  ');
    symbolsTrack.innerHTML = symbols;
}

function updateLiveTrack() { 
    updateSymbols(); 
}

// --- CONTROL DE SISTEMA ---

function triggerSignal(type, power) {
    isSignalActive = true;
    signalCooldown = true; 
    AudioEngine.play(type);
    
    setLockControls(true);

    const btn = document.getElementById('mouseBtn');
    const originalText = btn.innerText;
    btn.innerText = "PROCESANDO VECTOR...";
    btn.disabled = true;

    document.getElementById('main-terminal').classList.add('signal-active');
    const lastResult = tradeHistory[tradeHistory.length - 1];
    document.getElementById('ia-stake').innerText = lastResult === false ? "STAKE: X2.2 (RECOVERY)" : "STAKE: BASE (SAFETY)";
    
    document.getElementById('big-icon').style.display = "block";
    document.getElementById('big-icon').innerText = type === "COMPRA" ? "‚ñ≤" : "‚ñº";
    document.getElementById('op-status').innerText = type;
    document.getElementById('op-status').className = type === "COMPRA" ? "text-up" : "text-down";
    document.getElementById('big-icon').className = type === "COMPRA" ? "text-up" : "text-down";
    document.getElementById('main-terminal').className = `terminal signal-active ${type === "COMPRA" ? 'border-up' : 'border-down'}`;
    
    // IA Info en la se√±al
    const dna = sequence.slice(-4).map(s => s.val).join('');
    const conf = AICore.getConfidence(dna);
    document.getElementById('ia-logic').innerText = `IA: VECTOR CONFIRMADO (ADN CONF: ${conf})`;
    
    startCountdown();
    
    setTimeout(() => { 
        if (!isSignalActive) {
            btn.innerText = originalText;
            btn.disabled = false;
        }
    }, 2500);
}

function resetUI(fullReset = true) {
    if (countdownInterval) { clearInterval(countdownInterval); countdownInterval = null; }
    
    isSignalActive = false;
    signalCooldown = false; 
    
    setLockControls(false);

    const timerBar = document.getElementById('timer-bar');
    const terminal = document.getElementById('main-terminal');
    const btn = document.getElementById('mouseBtn');
    
    timerBar.style.transition = "none";
    timerBar.style.width = "0%";

    terminal.classList.remove('signal-active', 'high-noise-heart-red', 'high-noise-heart-green', 'border-up', 'border-down');
    terminal.style.background = "var(--panel-bg)";
    terminal.style.borderColor = "var(--border)";
    
    document.getElementById('op-status').innerText = "SYSTEM IDLE";
    document.getElementById('op-status').className = "";
    document.getElementById('op-details').innerText = "SCANNING DATA FLOW";
    document.getElementById('big-icon').style.display = "none";
    
    if (btn) {
        btn.innerText = mouseEnabled ? "SENSOR ACTIVO" : "INICIAR SENSOR RADAR";
        btn.disabled = false;
    }

    if(fullReset) {
        sequence = []; 
        chartData = Array(40).fill(40); 
        lastClickTime = 0;
        perfectFlow = false;
        document.getElementById('speed-meter').innerText = "MS: --";
        document.getElementById('noise-index').innerText = "NOISE: 0%";
        document.getElementById('power-index').innerText = "POWER: 0.0";
        drawChart(); 
        updateSymbols();
    }
}

// --- FUNCIONES DE SOPORTE (Config, Mouse, Stats) ---

function toggleMouse() {
    mouseEnabled = !mouseEnabled;
    AudioEngine.init();
    const overlay = document.getElementById('mouse-overlay');
    const btn = document.getElementById('mouseBtn');
    overlay.classList.toggle('active-radar', mouseEnabled);
    btn.classList.toggle('radar-on', mouseEnabled);
    btn.innerText = mouseEnabled ? "SENSOR ACTIVO" : "INICIAR SENSOR RADAR";
    document.getElementById('manual-touch-zone').style.display = mouseEnabled ? "grid" : "none";
    updateSymbols();
    if(!mouseEnabled) resetUI(true);
}

function setLockControls(lock) {
    const btns = document.querySelectorAll('.btn-group .btn');
    btns.forEach(b => {
        b.disabled = lock;
        b.style.opacity = lock ? "0.3" : "1";
        b.style.pointerEvents = lock ? "none" : "auto";
    });
}

function startCountdown() {
    const timerBar = document.getElementById('timer-bar');
    timerBar.style.width = "100%";
    timerBar.style.transition = "none";
    setTimeout(() => {
        timerBar.style.transition = `width ${selectedTime}s linear`;
        timerBar.style.width = "0%";
    }, 50);

    let timeLeft = selectedTime;
    countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) { clearInterval(countdownInterval); resetUI(false); }
    }, 1000);
}

// --- PERSISTENCIA Y CONFIG ---
function saveConfig() {
    localStorage.setItem('quantum_config', JSON.stringify({
        time: selectedTime, risk: riskLevel, flex: flexMode
    }));
}

function loadConfig() {
    const saved = JSON.parse(localStorage.getItem('quantum_config'));
    if(saved) {
        selectedTime = saved.time; riskLevel = saved.risk; flexMode = saved.flex;
        document.getElementById(`t${selectedTime}`)?.classList.add('active');
        document.getElementById(`r${riskLevel}`)?.classList.add('active');
        if(flexMode) document.getElementById('flexBtn')?.classList.add('active');
    } else {
        document.getElementById('t15')?.classList.add('active');
        document.getElementById('r2')?.classList.add('active');
    }
}

function setTime(s, btn) {
    if(isSignalActive) return;
    selectedTime = s;
    document.querySelectorAll('#time-group .btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active'); saveConfig();
}

function setRisk(l, btn) {
    if(isSignalActive) return;
    riskLevel = l;
    document.querySelectorAll('#risk-group .btn:not(#flexBtn)').forEach(b => b.classList.remove('active'));
    btn.classList.add('active'); saveConfig();
}

function toggleFlexMode() {
    if(isSignalActive) return;
    flexMode = !flexMode;
    document.getElementById('flexBtn')?.classList.toggle('active'); saveConfig();
}

function logResult(win) {
    // --- NUEVO: APRENDIZAJE NEURONAL ---
    // Recolectamos los datos actuales antes de resetear la UI
    if (typeof NeuralCore !== 'undefined' && NeuralCore.model) {
        const lastData = [
            parseInt(document.getElementById('speed-meter').innerText.replace('MS: ', '')) || 0,
            sequence[sequence.length-1]?.val === 'A' ? 1 : -1,
            parseInt(document.getElementById('noise-index').innerText.replace('NOISE: ', '')) || 0,
            parseFloat(document.getElementById('power-index').innerText.replace('POWER: ', '')) || 0
        ];
        
        // La red neuronal ajusta sus pesos matem√°ticos bas√°ndose en si acert√≥ o no
        NeuralCore.train(lastData, win);
    }

    // APRENDIZAJE IA ORIGINAL: Calibraci√≥n y registro de patr√≥n (Mantenemos tu l√≥gica)
    AICore.calibrate(win);
    if(win) AICore.learn();
    
    tradeHistory.push(win);
    localStorage.setItem('tradeHistory', JSON.stringify(tradeHistory));
    updateStats();
    resetUI(false); 
}

function updateStats() {
    const wins = tradeHistory.filter(x => x).length;
    const total = tradeHistory.length;
    document.getElementById('stat-total').innerText = total;
    document.getElementById('stat-winrate').innerText = total > 0 ? Math.round((wins/total)*100) + "%" : "0%";
}

// --- EVENT LISTENERS ---
const radarOverlay = document.getElementById('mouse-overlay');
radarOverlay.addEventListener('mousedown', (e) => {
    e.preventDefault(); 
    if (e.button === 0) registerInput('A');
    else if (e.button === 2) registerInput('B');
});
radarOverlay.addEventListener('contextmenu', (e) => { e.preventDefault(); e.stopPropagation(); return false; });
radarOverlay.addEventListener('touchstart', (e) => { if (e.touches.length > 1) e.preventDefault(); }, { passive: false });
radarOverlay.addEventListener('touchmove', (e) => { e.preventDefault(); }, { passive: false });

// --- INICIO ---
loadConfig();
const hSaved = localStorage.getItem('tradeHistory');
if(hSaved) { tradeHistory = JSON.parse(hSaved); updateStats(); }
drawChart();
updateSymbols();
</script>


</body>
</html>



