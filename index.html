<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Alpha PRO v22 | Full Logic Fixed</title>
    <style>
        :root {
            --bg-color: #040508;
            --panel-bg: #0a0d11;
            --up-neon: #00ff88; 
            --down-neon: #ff2e63; 
            --accent: #4a90e2;
            --text-dim: #717b87;
            --text-main: #ffffff;
            --border: #1c2128;
        }

        body {
            background: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #mouse-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1;
            cursor: crosshair;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.4) 100%);
        }
        #mouse-overlay.active-radar { display: block; pointer-events: auto; }

        .terminal {
            background: var(--panel-bg);
            width: 95%;
            max-width: 460px;
            border-radius: 20px;
            padding: 20px;
            border: 2px solid var(--border);
            position: relative;
            z-index: 10;
            box-shadow: 0 40px 80px rgba(0,0,0,0.7);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-weight: 800;
            margin-bottom: 15px;
            color: var(--text-dim);
            letter-spacing: 1px;
        }

        .selectors-grid {
            display: grid;
            grid-template-columns: 1.5fr 1.1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .btn-group { display: flex; gap: 4px; flex-wrap: wrap; }
        
        .btn {
            background: #161b22;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 8px 2px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 800;
            cursor: pointer;
            flex: 1;
            min-width: 35px;
            transition: 0.2s;
        }
        
        .btn.active { background: var(--accent); color: white; border-color: var(--accent); box-shadow: 0 0 10px rgba(74, 144, 226, 0.3); }
        .btn-flex { border-color: #8957e5; color: #8957e5; }
        .btn-flex.active { background: #8957e5; color: white; border-color: #8957e5; box-shadow: 0 0 12px rgba(137, 87, 229, 0.5); }

        .input-track {
            background: rgba(0,0,0,0.5);
            height: 40px;
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 20px;
            border: 1px solid var(--border);
        }

        .signal-zone {
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(255,255,255,0.02);
            border-radius: 16px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        #big-icon { font-size: 70px; font-weight: bold; display: none; line-height: 1; transition: 0.2s; }
        #op-status { font-size: 1.6rem; font-weight: 900; margin-top: 5px; letter-spacing: 1px; }
        #op-details { font-size: 10px; color: var(--accent); margin-top: 5px; font-weight: 700; text-transform: uppercase; }

        #mouseBtn {
            width: 100%;
            padding: 14px;
            border-radius: 12px;
            border: 2px solid var(--accent);
            background: transparent;
            color: var(--accent);
            font-weight: 900;
            cursor: pointer;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: 0.3s;
        }
        #mouseBtn.radar-on { background: var(--accent); color: white; box-shadow: 0 0 20px rgba(74, 144, 226, 0.4); }

        #ia-report {
            background: rgba(0,0,0,0.4);
            border-radius: 10px;
            padding: 12px;
            font-size: 11px;
            margin-bottom: 15px;
            border-left: 4px solid var(--border);
        }

        .feedback-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .feed-btn {
            padding: 15px;
            border-radius: 10px;
            color: white;
            font-weight: 900;
            cursor: pointer;
            opacity: 0.1;
            pointer-events: none;
            border: none;
            transition: 0.4s;
        }
        .active-signal { opacity: 1 !important; pointer-events: auto !important; transform: translateY(-2px); }

        .text-up { color: var(--up-neon) !important; text-shadow: 0 0 15px rgba(0, 255, 136, 0.5); }
        .text-down { color: var(--down-neon) !important; text-shadow: 0 0 15px rgba(255, 46, 99, 0.5); }
        .border-up { border-color: var(--up-neon) !important; box-shadow: 0 0 30px rgba(0, 255, 136, 0.15); }
        .border-down { border-color: var(--down-neon) !important; box-shadow: 0 0 30px rgba(255, 46, 99, 0.15); }

        #timer-bar {
            width: 0%;
            height: 2px;
            background: var(--accent);
            margin-top: 5px;
            transition: linear;
        }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="mouse-overlay"></div>

<div class="terminal" id="main-terminal">
    <div class="header-info">
        <span id="speed-meter">LATENCIA: 0ms</span>
        <span id="noise-index">RUIDO: 0%</span>
    </div>

    <div class="selectors-grid">
        <div class="btn-group" id="time-group">
            <button class="btn" onclick="setTime(3, this)">3S</button>
            <button class="btn" onclick="setTime(5, this)">5S</button>
            <button class="btn active" onclick="setTime(10, this)">10S</button>
            <button class="btn" onclick="setTime(15, this)">15S</button>
            <button class="btn" onclick="setTime(30, this)">30S</button>
            <button class="btn" onclick="setTime(60, this)">1M</button>
        </div>
        <div class="btn-group" id="risk-group">
            <button class="btn" onclick="setRisk(1, this)">N1</button>
            <button class="btn active" onclick="setRisk(2, this)">N2</button>
            <button class="btn" onclick="setRisk(3, this)">N3</button>
            <button id="flexBtn" class="btn btn-flex" onclick="toggleFlexMode()">FLEX</button>
        </div>
    </div>

    <div class="input-track" id="live-track">
        <span style="color: var(--text-dim); font-size: 10px;">ESPERANDO FLUJO...</span>
    </div>

    <button id="mouseBtn" onclick="toggleMouse()">INICIAR SENSOR RADAR</button>

    <div class="signal-zone">
        <div id="big-icon"></div>
        <div id="op-status">SISTEMA IDLE</div>
        <div id="op-details">MONITORIZANDO MERCADO</div>
        <div id="timer-bar"></div>
    </div>

    <div id="ia-report">
        <div id="ia-logic" style="color: var(--text-dim); margin-bottom: 3px;">IA: ESPERANDO SECUENCIA...</div>
        <div id="ia-stake" style="font-weight: 800; color: #fff;">GESTIÓN: SIN OPERACIÓN</div>
    </div>

    <div class="feedback-grid">
        <button id="winBtn" class="feed-btn" style="background:var(--up-neon); color: #000;" onclick="logResult(true)">WIN</button>
        <button id="lossBtn" class="feed-btn" style="background:var(--down-neon)" onclick="logResult(false)">LOSS</button>
    </div>

    <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 10px; color: var(--text-dim); font-weight: bold;">
        <span>SESIÓN: <span id="stat-total" style="color:white">0</span></span>
        <span>ACIERTO: <span id="stat-winrate" style="color:white">0%</span></span>
    </div>
</div>

<script>
let mouseEnabled = false, flexMode = false, sequence = [], tradeHistory = [];
let lastClickTime = 0, riskLevel = 2, selectedTime = 10;
let isSignalActive = false, countdownInterval = null;

const config = {
    racha: { 1: 3, 2: 4, 3: 5 },
    ruido: { 1: 65, 2: 55, 3: 45 }
};

// Audio Sintético para Señales
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSignalSound(type) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(type === "COMPRA" ? 880 : 440, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.5);
}

function toggleMouse() {
    mouseEnabled = !mouseEnabled;
    const overlay = document.getElementById('mouse-overlay');
    const btn = document.getElementById('mouseBtn');
    overlay.classList.toggle('active-radar', mouseEnabled);
    btn.classList.toggle('radar-on', mouseEnabled);
    btn.innerText = mouseEnabled ? "SENSOR ACTIVO" : "INICIAR SENSOR RADAR";
    if(!mouseEnabled) resetUI();
}

document.getElementById('mouse-overlay').addEventListener('mousedown', (e) => {
    if (!mouseEnabled) return;
    e.preventDefault();
    
    const now = Date.now();
    const diff = (lastClickTime === 0) ? 0 : now - lastClickTime;
    lastClickTime = now;

    let val = (e.button === 0) ? 'A' : (e.button === 2 ? 'B' : "");

    if(val !== "") {
        sequence.push({val, diff});
        if(sequence.length > 15) sequence.shift();
        updateLiveTrack();
        analyze();
    }
});

function updateLiveTrack() {
    const track = document.getElementById('live-track');
    track.innerHTML = sequence.map(s => 
        s.val === 'A' ? '<span class="text-up">▲</span>' : '<span class="text-down">▼</span>'
    ).join(' ');
}

function analyze() {
    if (isSignalActive) return;

    const seqStr = sequence.map(s => s.val).join('');
    const oscillations = (seqStr.match(/AB|BA/g) || []).length;
    const noiseIndex = Math.min(100, Math.round((oscillations / Math.max(1, seqStr.length - 1)) * 100));
    const recentSpeed = sequence.length > 1 ? sequence[sequence.length-1].diff : 0;
    
    document.getElementById('speed-meter').innerText = `LATENCIA: ${recentSpeed}ms`;
    document.getElementById('noise-index').innerText = `RUIDO: ${noiseIndex}%`;

    let maxAllowedNoise = config.ruido[riskLevel];
    if (flexMode) maxAllowedNoise += 15;

    const minR = config.racha[riskLevel];
    const isChoppy = noiseIndex > maxAllowedNoise;

    const rachaCompra = new RegExp('A{' + minR + '}$').test(seqStr);
    const rachaVenta = new RegExp('B{' + minR + '}$').test(seqStr);

    if (isChoppy) {
        updateStatus("RUIDO ALTO", "FILTRANDO VOLATILIDAD", "none");
    } else if (rachaCompra || rachaVenta) {
        isSignalActive = true; 
        const tipo = rachaCompra ? "COMPRA" : "VENTA";
        playSignalSound(tipo);
        showSignal(tipo, minR);
        startCountdown();
    } else {
        if (!isSignalActive) resetUI(false);
    }
}

function startCountdown() {
    let timeLeft = selectedTime;
    const iaS = document.getElementById('ia-stake');
    const timerBar = document.getElementById('timer-bar');
    
    timerBar.style.width = "100%";
    timerBar.style.transition = `width ${selectedTime}s linear`;
    setTimeout(() => timerBar.style.width = "0%", 100);

    countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            isSignalActive = false;
            resetUI(false);
        } else {
            iaS.innerText = `EXPIRACIÓN: ${timeLeft}s | ESPERE...`;
        }
    }, 1000);
}

function showSignal(type, power) {
    const status = document.getElementById('op-status');
    const icon = document.getElementById('big-icon');
    const term = document.getElementById('main-terminal');
    const iaL = document.getElementById('ia-logic');
    const iaS = document.getElementById('ia-stake');
    
    let prob = 72 + (power * 4) - (riskLevel * 2);
    if(flexMode) prob -= 4;

    icon.style.display = "block";
    icon.innerText = type === "COMPRA" ? "▲" : "▼";
    status.innerText = type;
    
    if (type === "COMPRA") {
        status.className = "text-up"; icon.className = "text-up";
        term.className = "terminal border-up";
    } else {
        status.className = "text-down"; icon.className = "text-down";
        term.className = "terminal border-down";
    }

    iaL.innerText = `IA: PATRÓN N${riskLevel} DETECTADO`;
    iaS.innerText = `EXPIRACIÓN: ${selectedTime}s | ESPERE...`;
    
    document.querySelectorAll('.feed-btn').forEach(b => b.classList.add('active-signal'));
}

function updateStatus(txt, detail, iconDisp) {
    document.getElementById('op-status').innerText = txt;
    document.getElementById('op-details').innerText = detail;
    document.getElementById('big-icon').style.display = iconDisp;
    document.getElementById('main-terminal').className = "terminal";
}

function resetUI(clearTrack = true) {
    clearInterval(countdownInterval);
    isSignalActive = false;
    updateStatus("SISTEMA IDLE", flexMode ? "MODO FLEX ACTIVADO" : "MONITORIZANDO MERCADO", "none");
    document.getElementById('op-status').className = "";
    document.getElementById('ia-logic').innerText = "IA: ANALIZANDO...";
    document.getElementById('ia-stake').innerText = "GESTIÓN: SIN OPERACIÓN";
    document.getElementById('timer-bar').style.transition = "none";
    document.getElementById('timer-bar').style.width = "0%";
    document.querySelectorAll('.feed-btn').forEach(b => b.classList.remove('active-signal'));
    if(clearTrack) {
        sequence = [];
        document.getElementById('live-track').innerHTML = '<span style="color: var(--text-dim); font-size: 10px;">ESPERANDO FLUJO...</span>';
    }
}

function setTime(s, btn) {
    selectedTime = s;
    const group = document.getElementById('time-group');
    group.querySelectorAll('.btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    resetUI();
}

function setRisk(l, btn) {
    riskLevel = l;
    const group = document.getElementById('risk-group');
    group.querySelectorAll('.btn:not(.btn-flex)').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    if(sequence.length > 0) analyze();
}

function toggleFlexMode() {
    flexMode = !flexMode;
    document.getElementById('flexBtn').classList.toggle('active');
    const detail = document.getElementById('op-details');
    detail.innerText = flexMode ? "MODO FLEX: ALTA TOLERANCIA" : "MONITORIZANDO MERCADO";
    if(sequence.length > 0) analyze();
}

function logResult(win) {
    tradeHistory.push(win);
    document.getElementById('stat-total').innerText = tradeHistory.length;
    const wins = tradeHistory.filter(x => x).length;
    document.getElementById('stat-winrate').innerText = Math.round((wins/tradeHistory.length)*100) + "%";
    resetUI();
}
</script>
</body>
</html>
