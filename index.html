<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Alpha PRO v22 | Ultimate Edition</title>
    <style>
        :root {
            --bg-color: #040508;
            --panel-bg: #0a0d11;
            --up-neon: #00ff88; 
            --down-neon: #ff2e63; 
            --accent: #4a90e2;
            --text-dim: #717b87;
            --text-main: #ffffff;
            --border: #1c2128;
            --glow: rgba(74, 144, 226, 0.2);
        }

        body {
            background: var(--bg-color);
            color: var(--text-main);
            font-family: 'Inter', system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            user-select: none;
        }

        #mouse-overlay {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 1;
            cursor: crosshair;
            background: radial-gradient(circle, transparent 30%, rgba(0,0,0,0.6) 100%);
        }
        #mouse-overlay.active-radar { display: block; pointer-events: auto; }

        .terminal {
            background: var(--panel-bg);
            width: 95%;
            max-width: 460px;
            border-radius: 24px;
            padding: 24px;
            border: 2px solid var(--border);
            position: relative;
            z-index: 10;
            box-shadow: 0 40px 80px rgba(0,0,0,0.8);
            backdrop-filter: blur(10px);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            font-weight: 900;
            margin-bottom: 15px;
            color: var(--text-dim);
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        /* Canvas Gráfico */
        #flow-chart {
            width: 100%;
            height: 60px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            margin-bottom: 15px;
            border: 1px solid var(--border);
        }

        .selectors-grid {
            display: grid;
            grid-template-columns: 1.5fr 1.1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .btn-group { display: flex; gap: 4px; flex-wrap: wrap; }
        
        .btn {
            background: #161b22;
            border: 1px solid var(--border);
            color: var(--text-dim);
            padding: 8px 2px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 800;
            cursor: pointer;
            flex: 1;
            transition: 0.2s;
        }
        
        .btn.active { 
            background: var(--accent); 
            color: white; 
            border-color: var(--accent); 
            box-shadow: 0 0 15px var(--glow); 
        }

        .input-track {
            background: rgba(0,0,0,0.6);
            height: 45px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 22px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .signal-zone {
            height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: linear-gradient(145deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
            border-radius: 20px;
            margin-bottom: 15px;
            border: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        #big-icon { font-size: 80px; font-weight: bold; display: none; line-height: 1; z-index: 2; }
        #op-status { font-size: 1.8rem; font-weight: 900; margin-top: 5px; z-index: 2; }
        #op-details { font-size: 11px; color: var(--accent); font-weight: 700; text-transform: uppercase; z-index: 2; }

        #mouseBtn {
            width: 100%;
            padding: 16px;
            border-radius: 14px;
            border: 2px solid var(--accent);
            background: transparent;
            color: var(--accent);
            font-weight: 900;
            cursor: pointer;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: 0.3s ease;
        }
        #mouseBtn.radar-on { 
            background: var(--accent); 
            color: white; 
            box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4); 
        }

        #ia-report {
            background: rgba(0,0,0,0.5);
            border-radius: 12px;
            padding: 14px;
            font-size: 11px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }

        .feedback-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .feed-btn {
            padding: 16px;
            border-radius: 12px;
            color: white;
            font-weight: 900;
            cursor: pointer;
            opacity: 0.05;
            pointer-events: none;
            border: none;
            transition: 0.3s;
        }
        .active-signal { opacity: 1 !important; pointer-events: auto !important; transform: scale(1.02); }

        /* Estados de Neon */
        .text-up { color: var(--up-neon) !important; text-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
        .text-down { color: var(--down-neon) !important; text-shadow: 0 0 20px rgba(255, 46, 99, 0.6); }
        .border-up { border-color: var(--up-neon) !important; box-shadow: 0 0 40px rgba(0, 255, 136, 0.1); }
        .border-down { border-color: var(--down-neon) !important; box-shadow: 0 0 40px rgba(255, 46, 99, 0.1); }

        #timer-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: var(--accent);
            border-radius: 0 0 20px 20px;
        }
    </style>
</head>
<body oncontextmenu="return false;">

<div id="mouse-overlay"></div>

<div class="terminal" id="main-terminal">
    <div class="header-info">
        <span id="speed-meter">MS: 0</span>
        <span id="power-index">POWER: 0.0</span>
        <span id="noise-index">NOISE: 0%</span>
    </div>

    <canvas id="flow-chart"></canvas>

    <div class="selectors-grid">
        <div class="btn-group" id="time-group">
            <button class="btn" onclick="setTime(5, this)">5S</button>
            <button class="btn active" onclick="setTime(15, this)">15S</button>
            <button class="btn" onclick="setTime(30, this)">30S</button>
            <button class="btn" onclick="setTime(60, this)">1M</button>
        </div>
        <div class="btn-group" id="risk-group">
            <button class="btn" onclick="setRisk(1, this)">N1</button>
            <button class="btn active" onclick="setRisk(2, this)">N2</button>
            <button class="btn" onclick="setRisk(3, this)">N3</button>
            <button id="flexBtn" class="btn btn-flex" style="border-color:#8957e5" onclick="toggleFlexMode()">FLEX</button>
        </div>
    </div>

    <div class="input-track" id="live-track">
        <span style="color: var(--text-dim); font-size: 10px;">READY FOR SCAN</span>
    </div>

    <button id="mouseBtn" onclick="toggleMouse()">INICIAR SENSOR RADAR</button>

    <div class="signal-zone">
        <div id="big-icon"></div>
        <div id="op-status">SYSTEM IDLE</div>
        <div id="op-details">SCANNING DATA FLOW</div>
        <div id="timer-bar"></div>
    </div>

    <div id="ia-report">
        <div id="ia-logic" style="color: var(--text-dim); margin-bottom: 4px;">IA: WAITING SEQUENCE...</div>
        <div id="ia-stake" style="font-weight: 800; color: #fff;">STAKE SUGGESTION: --</div>
    </div>

    <div class="feedback-grid">
        <button id="winBtn" class="feed-btn" style="background:var(--up-neon); color: #000;" onclick="logResult(true)">WIN</button>
        <button id="lossBtn" class="feed-btn" style="background:var(--down-neon)" onclick="logResult(false)">LOSS</button>
    </div>

    <div style="display: flex; justify-content: space-between; margin-top: 15px; font-size: 10px; color: var(--text-dim); font-weight: 900;">
        <span>SESIÓN: <span id="stat-total" style="color:white">0</span></span>
        <span>ACCURACY: <span id="stat-winrate" style="color:white">0%</span></span>
    </div>
</div>

<script>
let mouseEnabled = false, flexMode = false, sequence = [], tradeHistory = [];
let lastClickTime = 0, riskLevel = 2, selectedTime = 15;
let isSignalActive = false, countdownInterval = null;

const config = {
    racha: { 1: 3, 2: 4, 3: 5 },
    ruido: { 1: 65, 2: 55, 3: 45 }
};

// --- AUDIO Y HÁPTICA ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSignalSound(type) {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain); gain.connect(audioCtx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime(type === "COMPRA" ? 880 : 330, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.6);
    osc.start(); osc.stop(audioCtx.currentTime + 0.6);
    if(navigator.vibrate) navigator.vibrate(type === "COMPRA" ? [30, 10, 30] : [50]);
}

// --- LÓGICA DE GRÁFICO (CANVAS) ---
const canvas = document.getElementById('flow-chart');
const ctx = canvas.getContext('2d');
let chartData = Array(30).fill(30);

function drawChart() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.strokeStyle = '#4a90e2';
    ctx.lineWidth = 2;
    ctx.lineJoin = 'round';
    
    const step = canvas.width / (chartData.length - 1);
    chartData.forEach((val, i) => {
        const x = i * step;
        const y = canvas.height / 2 + (val * 0.5); // Normalizar
        if(i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
    });
    ctx.stroke();
}

// --- MOTOR DE ANÁLISIS ---
function toggleMouse() {
    mouseEnabled = !mouseEnabled;
    const overlay = document.getElementById('mouse-overlay');
    const btn = document.getElementById('mouseBtn');
    overlay.classList.toggle('active-radar', mouseEnabled);
    btn.classList.toggle('radar-on', mouseEnabled);
    btn.innerText = mouseEnabled ? "SENSOR ACTIVO" : "INICIAR SENSOR RADAR";
    if(!mouseEnabled) resetUI();
}

document.getElementById('mouse-overlay').addEventListener('mousedown', (e) => {
    if (!mouseEnabled) return;
    e.preventDefault();
    
    const now = Date.now();
    const diff = (lastClickTime === 0) ? 0 : now - lastClickTime;
    lastClickTime = now;

    let val = (e.button === 0) ? 'A' : (e.button === 2 ? 'B' : "");

    if(val !== "") {
        sequence.push({val, diff});
        if(sequence.length > 20) sequence.shift();
        
        // Actualizar gráfico (A sube, B baja)
        const lastVal = chartData[chartData.length - 1];
        chartData.push(val === 'A' ? lastVal - 5 : lastVal + 5);
        if(chartData.length > 30) chartData.shift();
        drawChart();
        
        updateLiveTrack();
        analyze();
    }
});

function analyze() {
    if (isSignalActive) return;

    const seqStr = sequence.map(s => s.val).join('');
    const recentSpeed = sequence.length > 1 ? sequence[sequence.length-1].diff : 0;
    
    // 1. Cálculo de Ruido
    const oscillations = (seqStr.match(/AB|BA/g) || []).length;
    const noiseIndex = Math.min(100, Math.round((oscillations / Math.max(1, seqStr.length - 1)) * 100));

    // 2. Cálculo de Poder (Aceleración)
    const power = sequence.reduce((acc, s) => {
        return s.val === 'A' ? acc + (1000/Math.max(s.diff, 50)) : acc - (1000/Math.max(s.diff, 50));
    }, 0);

    document.getElementById('speed-meter').innerText = `MS: ${recentSpeed}`;
    document.getElementById('noise-index').innerText = `NOISE: ${noiseIndex}%`;
    document.getElementById('power-index').innerText = `POWER: ${power.toFixed(1)}`;

    let maxAllowedNoise = config.ruido[riskLevel];
    if (flexMode) maxAllowedNoise += 15;

    const minR = config.racha[riskLevel];
    const rachaCompra = new RegExp('A{' + minR + '}$').test(seqStr);
    const rachaVenta = new RegExp('B{' + minR + '}$').test(seqStr);

    if (noiseIndex > maxAllowedNoise) {
        updateStatus("HIGH NOISE", "WAITING FOR STABILITY", "none");
    } else if (rachaCompra || rachaVenta) {
        triggerSignal(rachaCompra ? "COMPRA" : "VENTA", power);
    }
}

function triggerSignal(type, power) {
    isSignalActive = true;
    playSignalSound(type);
    
    const status = document.getElementById('op-status');
    const icon = document.getElementById('big-icon');
    const term = document.getElementById('main-terminal');
    const iaS = document.getElementById('ia-stake');
    
    // Gestión de Capital Dinámica
    const lastResult = tradeHistory[tradeHistory.length - 1];
    const stakeText = lastResult === false ? "STAKE: X2 (RECOVERY MODE)" : "STAKE: BASE (CONSERVATIVE)";
    iaS.innerText = stakeText;

    icon.style.display = "block";
    icon.innerText = type === "COMPRA" ? "▲" : "▼";
    status.innerText = type;
    status.className = type === "COMPRA" ? "text-up" : "text-down";
    icon.className = type === "COMPRA" ? "text-up" : "text-down";
    term.className = `terminal ${type === "COMPRA" ? 'border-up' : 'border-down'}`;

    document.getElementById('ia-logic').innerText = `IA: POWER ${Math.abs(power).toFixed(1)} CONFIRMED`;
    document.querySelectorAll('.feed-btn').forEach(b => b.classList.add('active-signal'));
    
    startCountdown();
}

function startCountdown() {
    let timeLeft = selectedTime;
    const timerBar = document.getElementById('timer-bar');
    timerBar.style.width = "100%";
    timerBar.style.transition = `width ${selectedTime}s linear`;
    setTimeout(() => timerBar.style.width = "0%", 50);

    countdownInterval = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            isSignalActive = false;
            resetUI(false);
        }
    }, 1000);
}

function resetUI(clearTrack = true) {
    clearInterval(countdownInterval);
    isSignalActive = false;
    document.getElementById('main-terminal').className = "terminal";
    document.getElementById('op-status').innerText = "SYSTEM IDLE";
    document.getElementById('op-status').className = "";
    document.getElementById('op-details').innerText = "SCANNING DATA FLOW";
    document.getElementById('big-icon').style.display = "none";
    document.getElementById('timer-bar').style.transition = "none";
    document.getElementById('timer-bar').style.width = "0%";
    document.querySelectorAll('.feed-btn').forEach(b => b.classList.remove('active-signal'));
    if(clearTrack) {
        sequence = [];
        chartData = Array(30).fill(30);
        drawChart();
        document.getElementById('live-track').innerHTML = '<span style="color:var(--text-dim);font-size:10px;">READY FOR SCAN</span>';
    }
}

function logResult(win) {
    tradeHistory.push(win);
    document.getElementById('stat-total').innerText = tradeHistory.length;
    const wins = tradeHistory.filter(x => x).length;
    document.getElementById('stat-winrate').innerText = Math.round((wins/tradeHistory.length)*100) + "%";
    resetUI();
}

function updateLiveTrack() {
    const track = document.getElementById('live-track');
    track.innerHTML = sequence.slice(-10).map(s => 
        s.val === 'A' ? '<span class="text-up">▲</span>' : '<span class="text-down">▼</span>'
    ).join(' ');
}

function setTime(s, btn) {
    selectedTime = s;
    document.querySelectorAll('#time-group .btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function setRisk(l, btn) {
    riskLevel = l;
    document.querySelectorAll('#risk-group .btn:not(.btn-flex)').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function toggleFlexMode() {
    flexMode = !flexMode;
    document.getElementById('flexBtn').classList.toggle('active');
}

function updateStatus(txt, detail, iconDisp) {
    document.getElementById('op-status').innerText = txt;
    document.getElementById('op-details').innerText = detail;
    document.getElementById('big-icon').style.display = iconDisp;
}

// Inicializar
drawChart();
</script>
</body>
</html>
